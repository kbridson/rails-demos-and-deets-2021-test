<!doctype html>
<html lang="en">
    <head>
        <!-- Required meta tags -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Web Development with Ruby on Rails Tutorial 2019">
<meta name="author" content="Scott Fleming">

<link rel="shortcut icon" type="image/png" href="/rails-tutorial-2019/assets/img/favicon.png">

<title>Demo 7: Passing Data From View to Controller | Web Development with Ruby on Rails Tutorial 2019</title>

        <!-- Bootstrap CSS -->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

<!-- Custom styles for this site -->
<link href="/rails-tutorial-2019/assets/css/site.css" rel="stylesheet">

    </head>
    <body>
        


<header>
    <nav class="navbar navbar-expand-md navbar-light bg-light">
        <a class="navbar-brand" href="/rails-tutorial-2019/"><img src="/rails-tutorial-2019/assets/img/brand.png" style="height: 3.5rem"></a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarsExampleDefault">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item ">
                    <a class="nav-link" href="/rails-tutorial-2019/">Home</a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/rails-tutorial-2019/about/">About</a>
                </li>
                </ul>
        </div>
    </nav>
</header>

        <main role="main">

            <div class="container mt-4">
                <h1 id="demo-7-passing-data-from-view-to-controller">Demo 7: Passing Data From View to Controller</h1>

<p>In this demonstration, I will show how to pass data collected with a form in the view to the controller action for processing. I will continue to work on the <em>QuizMe</em> project from the previous demos.</p>

<p>This and all future demos will assume you are starting in the workspace folder on your virtual machine.</p>

<h2 id="pre-demo-setup">Pre-demo Setup</h2>

<ol>
  <li>
    <p>Add a new contact page to house form <em>QuizMe</em> users can use to send feedback to the developers. The contact page should have the URL <a href="http://localhost:3000/contact">http://localhost:3000/contact</a>. The contact view should start with the following base content:</p>

    <div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nt">&lt;h1&gt;</span>Contact Us<span class="nt">&lt;/h1&gt;</span>

 <span class="nt">&lt;p&gt;</span>We welcome your feedback. Please submit the form below to let us know what you think or alert us to any problems you are having with QuizMe.<span class="nt">&lt;/p&gt;</span>

 <span class="nt">&lt;h2&gt;</span>Feedback<span class="nt">&lt;/h2&gt;</span>

 <span class="c">&lt;!-- Feedback form --&gt;</span>

 <span class="nt">&lt;p&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'Welcome'</span><span class="p">,</span> <span class="n">welcome_path</span> <span class="cp">%&gt;</span><span class="nt">&lt;/p&gt;</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Add a link to the contact page to the bottom of the welcome page.</p>
  </li>
</ol>

<h2 id="1-collecting-data-from-the-user-in-the-view">1. Collecting Data from the User in the View</h2>

<p>TODO: whats a form and request cycle things</p>

<p>I will be building this <a href="/resources/feedback-form.png">feedback form</a> that collects users’ name, email, whether someone from <em>QuizMe</em> is allowed to contact them at the provided email, the kind of feedback they want to leave, and their message. All form fields will be required. Submitting the form will reload the contact page with a status message that tells the user if the submission was valid or if they missed any fields.</p>

<ol>
  <li>
    <p>Create a POST route for the URL <a href="http://localhost:3000/contact">http://localhost:3000/contact</a> that points to a new <code class="highlighter-rouge">leave_feedback</code> action in the StaticPagesController and name the new route “leave_feedback”.  The new route should match:</p>

    <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="n">post</span> <span class="s1">'contact'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'static_pages#leave_feedback'</span><span class="p">,</span> <span class="ss">as: </span><span class="s1">'leave_feedback'</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Create the <code class="highlighter-rouge">leave_feedback</code> action in the controller. It should return an HTML response that renders the <code class="highlighter-rouge">contact.html.erb</code> view. The action should match:</p>

    <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">def</span> <span class="nf">leave_feedback</span>
   <span class="n">respond_to</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
     <span class="nb">format</span><span class="p">.</span><span class="nf">html</span> <span class="p">{</span> <span class="n">render</span> <span class="ss">:contact</span> <span class="p">}</span>
   <span class="k">end</span>
 <span class="k">end</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>In the <code class="highlighter-rouge">contact.html.erb</code> view, create a form block using the <code class="highlighter-rouge">form_with</code> helper in the indicated location. Specify that the form should send a POST request to the <code class="highlighter-rouge">leave_feedback_path</code> URL by setting the <code class="highlighter-rouge">url</code> and <code class="highlighter-rouge">method</code> options on the <code class="highlighter-rouge">form_with</code>. By default, <code class="highlighter-rouge">form_with</code> expects the action to return a Javascript response in the <code class="highlighter-rouge">respond_to</code> block, but we need an HTML response so we can specify HTML with the <code class="highlighter-rouge">local: true</code> option. The form block should match:</p>

    <div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">url: </span><span class="n">leave_feedback_path</span><span class="p">,</span> <span class="ss">local: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">method: :post</span> <span class="k">do</span> <span class="cp">%&gt;</span>

 <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre></div>    </div>

    <p>Notice the &lt;%= %&gt; are used with these helper functions because they return raw HTML which we want displayed in the browser.</p>
  </li>
  <li>
    <p>In the <code class="highlighter-rouge">form_with</code> block, add a text field for the users’ name, an email field for the users’ email, a radio button group for whether someone from <em>QuizMe</em> is allowed to contact them at the provided email, a dropdown select for the kind of feedback they want to leave, and a textarea for their message.</p>

    <div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">url: </span><span class="n">leave_feedback_path</span><span class="p">,</span> <span class="ss">local: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">method: :post</span> <span class="k">do</span> <span class="cp">%&gt;</span>

   <span class="nt">&lt;div&gt;</span>
     <span class="cp">&lt;%=</span> <span class="n">label_tag</span> <span class="s2">"name"</span> <span class="cp">%&gt;</span>
     <span class="cp">&lt;%=</span> <span class="n">text_field_tag</span> <span class="s2">"name"</span><span class="p">,</span> <span class="kp">nil</span> <span class="cp">%&gt;</span>
   <span class="nt">&lt;/div&gt;</span>

   <span class="nt">&lt;div&gt;</span>
     <span class="cp">&lt;%=</span> <span class="n">label_tag</span> <span class="s2">"email"</span> <span class="cp">%&gt;</span>
     <span class="cp">&lt;%=</span> <span class="n">email_field_tag</span> <span class="s2">"email"</span><span class="p">,</span> <span class="kp">nil</span> <span class="cp">%&gt;</span>
   <span class="nt">&lt;/div&gt;</span>

   <span class="nt">&lt;div&gt;</span>
     <span class="nt">&lt;span&gt;</span>Can we contact you by email?<span class="nt">&lt;/span&gt;</span>
     <span class="nt">&lt;div&gt;</span>
       <span class="cp">&lt;%=</span> <span class="n">radio_button_tag</span> <span class="s2">"reply"</span><span class="p">,</span> <span class="kp">true</span><span class="p">,</span> <span class="kp">true</span> <span class="cp">%&gt;</span>
       <span class="cp">&lt;%=</span> <span class="n">label_tag</span> <span class="s2">"reply_yes"</span><span class="p">,</span> <span class="s1">'Yes'</span> <span class="cp">%&gt;</span>
     <span class="nt">&lt;/div&gt;</span>
     <span class="nt">&lt;div&gt;</span>
       <span class="cp">&lt;%=</span> <span class="n">radio_button_tag</span> <span class="s2">"reply"</span><span class="p">,</span> <span class="kp">false</span><span class="p">,</span> <span class="kp">false</span> <span class="cp">%&gt;</span>
       <span class="cp">&lt;%=</span> <span class="n">label_tag</span> <span class="s2">"reply_no"</span><span class="p">,</span> <span class="s1">'No'</span> <span class="cp">%&gt;</span>
     <span class="nt">&lt;/div&gt;</span>
   <span class="nt">&lt;/div&gt;</span>

   <span class="nt">&lt;div&gt;</span>
     <span class="cp">&lt;%=</span> <span class="n">label_tag</span> <span class="s2">"feedback_type"</span> <span class="cp">%&gt;</span>
     <span class="cp">&lt;%=</span> <span class="n">select_tag</span> <span class="s2">"feedback_type"</span><span class="p">,</span> <span class="n">options_for_select</span><span class="p">([</span> <span class="s2">"Review"</span><span class="p">,</span> <span class="s2">"Bug Report"</span> <span class="p">]),</span> <span class="ss">prompt: </span><span class="s1">'Choose one...'</span> <span class="cp">%&gt;</span>
   <span class="nt">&lt;/div&gt;</span>

   <span class="nt">&lt;div&gt;</span>
     <span class="cp">&lt;%=</span> <span class="n">label_tag</span> <span class="s2">"message"</span> <span class="cp">%&gt;</span><span class="nt">&lt;br</span> <span class="nt">/&gt;</span>
     <span class="cp">&lt;%=</span> <span class="n">text_area_tag</span> <span class="s2">"message"</span><span class="p">,</span> <span class="kp">nil</span><span class="p">,</span> <span class="ss">size: </span><span class="s2">"27x7"</span> <span class="cp">%&gt;</span>
   <span class="nt">&lt;/div&gt;</span>

   <span class="cp">&lt;%=</span> <span class="n">submit_tag</span><span class="p">(</span><span class="s2">"Send Feedback"</span><span class="p">)</span> <span class="cp">%&gt;</span>

 <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre></div>    </div>
  </li>
</ol>

            </div> <!-- /.container -->

        </main>

        <footer class="container">
            <hr style="margin-top: 2rem;">
            <p style="text-align: center;">
                &copy; <a href="/about/">The Authors</a> 2019
            </p>
        </footer>

        <!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

    </body>
</html>
