<!doctype html>
<html lang="en">
    <head>
        <!-- Required meta tags -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Web Development with Ruby on Rails Tutorial 2019">
<meta name="author" content="Scott Fleming">

<link rel="shortcut icon" type="image/png" href="/rails-demos-n-deets-2020/assets/img/favicon.png">

<title>Passing Notification Messages to the View with the Flash | Ruby on Rails ⇨ Demos 'n' Deets</title>

        <!-- Bootstrap CSS -->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

<!-- Custom styles for this site -->
<link href="/rails-demos-n-deets-2020/assets/css/site.css" rel="stylesheet">

    </head>
    <body>
        


<header>
    <nav class="navbar navbar-expand-md navbar-light bg-light">
        <a class="navbar-brand" href="/rails-demos-n-deets-2020/"><img src="/rails-demos-n-deets-2020/assets/img/brand.png" style="height: 3.5rem"></a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarsExampleDefault">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item ">
                    <a class="nav-link" href="/rails-demos-n-deets-2020/">Home</a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/rails-demos-n-deets-2020/about/">About</a>
                </li>
                </ul>
        </div>
    </nav>
</header>

        <main role="main">

            <div class="container mt-4">
                <div class="d-block text-center">
    <p class="display-4 mb-0">
        &#128679;&nbsp;Under Construction&nbsp;&#128679;
    </p>
    <p class="mt-0">
        Sorry! This page isn't quite finished yet.
    </p>
</div>

<h1 id="passing-notification-messages-to-the-view-with-the-flash">Passing Notification Messages to the View with the Flash</h1>

<p>In this demonstration, I will show how to XXX. We will continue to build upon the <a href="https://github.com/human-se/quiz-me-2020" target="_blank">QuizMe project</a> from the previous demos.</p>

<h2 id="1-passing-notification-messages-to-the-view-with-the-flash">1. Passing Notification Messages to the View with the Flash</h2>

<p>In this part, we will refactor our existing notification-message code to work better with the new forms we will be implementing. It is common for modern web apps to display notification messages after the user performs certain operations. For example, if the user submits a form, a success notification might appear to let them know that the submission was successful. Similarly, if the form submission failed, an error notification might appear.</p>

<p>To implement such messages, Rails provides <em>the flash</em>. The flash is basically a hash that controllers and ERBs can read and write. The flash is part of the session, so the data stored in the flash is specific to a particular user session. What makes the flash special is that the saved data is available only for the next HTTP request of the session. When that request completes, the data is automatically deleted. (For more info on sessions and the flash, see <a href="/rails-demos-n-deets-2020/deets-sessions/">this deets page</a>.)</p>

<p>To demonstrate using the flash, let’s refactor the code we wrote for the feedback form’s status message. Instead of passing the status message to the view as a local variable, we can put the message in the <code class="highlighter-rouge">flash</code> hash under the key <code class="highlighter-rouge">:status_msg</code>, like this:</p>

<p>In the <code class="highlighter-rouge">leave_feedback</code> method of <code class="highlighter-rouge">StaticPagesController</code>, remove the status message from the <code class="highlighter-rouge">locals</code> hash, and add the status message to the <code class="highlighter-rouge">flash</code> hash, like this:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">respond_to</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
  <span class="nb">format</span><span class="p">.</span><span class="nf">html</span> <span class="p">{</span>
    <span class="n">flash</span><span class="p">.</span><span class="nf">now</span><span class="p">[</span><span class="ss">:status_msg</span><span class="p">]</span> <span class="o">=</span> <span class="n">form_status_msg</span>
    <span class="n">render</span> <span class="ss">:contact</span><span class="p">,</span> <span class="ss">locals: </span><span class="p">{</span> <span class="ss">feedback: </span><span class="n">params</span> <span class="p">}</span>
  <span class="p">}</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Note that in this example we use <code class="highlighter-rouge">flash.now</code>, because we want the flash notification to be available during the current request (and not the next one).</p>

<p>In the <code class="highlighter-rouge">contact.html.erb</code> view, replace the current code for displaying the status message with the following code that displays the status message using the flask:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%</span> <span class="k">if</span> <span class="n">flash</span><span class="p">.</span><span class="nf">key?</span> <span class="ss">:status_msg</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;p&gt;</span><span class="cp">&lt;%=</span> <span class="n">flash</span><span class="p">[</span><span class="ss">:status_msg</span><span class="p">]</span> <span class="cp">%&gt;</span><span class="nt">&lt;/p&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<p>Submit the feedback form to see the flash message working.</p>

<p>Since it is common to display flash messages in a variety of different views, it makes the the most sense to put the above view code in a single place—namely, the <code class="highlighter-rouge">application.html.erb</code> layout. In Rails, when a controller action renders a view, that view is implicitly wrapped in the default layout, <code class="highlighter-rouge">application.html.erb</code>, found in <code class="highlighter-rouge">app/views/layouts</code>. This layout contains the <code class="highlighter-rouge"><span class="nt">&lt;html&gt;</span></code>, <code class="highlighter-rouge">&lt;head&gt;</code>, <code class="highlighter-rouge">&lt;body&gt;</code>, etc. tags required for all HTML pages. View code we write, such as <code class="highlighter-rouge">show.html.erb</code>, is actually rendered inside the <code class="highlighter-rouge">application.html.erb</code> layout. A <code class="highlighter-rouge">&lt;%= yield %&gt;</code> statement within <code class="highlighter-rouge">application.html.erb</code> specifies where the view code is inserted. To move the code for displaying flash messages to the <code class="highlighter-rouge">application.html.erb</code> layout, we do as follows.</p>

<p>Display all flash messages (if there are any) on any given page by inserting the following code above the <code class="highlighter-rouge">&lt;%= yield %&gt;</code> in <code class="highlighter-rouge">application.html.erb</code>, like this:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%</span> <span class="n">flash</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">key</span><span class="p">,</span> <span class="n">message</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;p&gt;</span><span class="cp">&lt;%=</span> <span class="n">message</span> <span class="cp">%&gt;</span><span class="nt">&lt;/p&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<p>Remove the now redundant flash message displaying code in the <code class="highlighter-rouge">contact.html.erb</code> view.</p>

<p>You should be able to run the app and see that the notification messages are still working.</p>

<p><strong><a href="xxx" target="_blank">➥ Code changeset for this part</a></strong></p>

<nav aria-label="Page navigation">
    <ul class="pagination justify-content-center">
        
            
            <li class="page-item"><a class="page-link" href="/rails-demos-n-deets-2020/demo-custom-validations/">⇦ Previous: Creating and Testing Custom Validations</a></li>
        
        
            
            <li class="page-item"><a class="page-link" href="/rails-demos-n-deets-2020/demo-new-create/">⇨ Next: Forms for Creating New Model Records</a></li>
        
    </ul>
</nav>


            </div> <!-- /.container -->

        </main>

        <footer class="container">
            <hr style="margin-top: 2rem;">
            <p style="text-align: center;">
                &copy; <a href="/about/">The Authors</a> 2020
            </p>
        </footer>

        <!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

    </body>
</html>
