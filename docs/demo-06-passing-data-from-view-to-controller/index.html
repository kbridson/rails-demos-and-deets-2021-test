<!doctype html>
<html lang="en">
    <head>
        <!-- Required meta tags -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Web Development with Ruby on Rails Tutorial 2019">
<meta name="author" content="Scott Fleming">

<link rel="shortcut icon" type="image/png" href="/rails-tutorial-2019/assets/img/favicon.png">

<title>Demo 6: Passing Data from View to Controller | Web Development with Ruby on Rails Tutorial 2019</title>

        <!-- Bootstrap CSS -->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

<!-- Custom styles for this site -->
<link href="/rails-tutorial-2019/assets/css/site.css" rel="stylesheet">

    </head>
    <body>
        


<header>
    <nav class="navbar navbar-expand-md navbar-light bg-light">
        <a class="navbar-brand" href="/rails-tutorial-2019/"><img src="/rails-tutorial-2019/assets/img/brand.png" style="height: 3.5rem"></a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarsExampleDefault">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item ">
                    <a class="nav-link" href="/rails-tutorial-2019/">Home</a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="/rails-tutorial-2019/about/">About</a>
                </li>
                </ul>
        </div>
    </nav>
</header>

        <main role="main">

            <div class="container mt-4">
                <h1 id="demo-6-passing-data-from-view-to-controller">Demo 6: Passing Data from View to Controller</h1>

<p>In this demonstration, I will show how to pass data collected with a form in the view to the controller action for processing. I will continue to work on the <em>QuizMe</em> project from the previous demos.</p>

<p>In particular, the form will appear within a <em>Contact</em> page, and it will be used to collect feedback on the app (see Fig. 1).</p>

<div class="figure-container mx-auto my-4" style="max-width: 960px;">
<figure class="figure">
<img src="/rails-tutorial-2019/resources/feedback-form.png" class="figure-img img-fluid rounded" alt="A web page with a form for providing feedback on the QuizMe application." />
<figcaption class="figure-caption">Fig 1. The <i>Contact</i> page with feedback form.</figcaption>
</figure>
</div>

<h2 id="1-adding-the-new-page-to-hold-the-form">1. Adding the New Page to Hold the Form</h2>

<p>In this part, I will create the new <em>Contact</em> page that will later hold the form. Since this part involves only tasks that have already been covered in a <a href="/rails-tutorial-2019/demo-04-rails-static-pages/">previous demo</a>, I give only a brief description of the steps.</p>

<ol>
  <li>
    <p>Add a new contact page to house form <em>QuizMe</em> users can use to send feedback to the developers. The contact page should have the URL <a href="http://localhost:3000/contact">http://localhost:3000/contact</a>. The contact view should start with the following base content:</p>

    <div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nt">&lt;h1&gt;</span>Contact Us<span class="nt">&lt;/h1&gt;</span>

 <span class="nt">&lt;p&gt;</span>We welcome your feedback. Please submit the form below to let us know what you think or alert us to any problems you are having with QuizMe.<span class="nt">&lt;/p&gt;</span>

 <span class="nt">&lt;h2&gt;</span>Feedback<span class="nt">&lt;/h2&gt;</span>

 <span class="c">&lt;!-- Feedback form will go here --&gt;</span>

 <span class="nt">&lt;p&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'Welcome'</span><span class="p">,</span> <span class="n">welcome_path</span> <span class="cp">%&gt;</span><span class="nt">&lt;/p&gt;</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Add a link to the <em>Contact</em> page to the bottom of the <em>Welcome</em> page.</p>
  </li>
</ol>

<h2 id="2-collecting-form-data-from-the-user">2. Collecting Form Data from the User</h2>

<p>In this part, I will be building the form depicted in Fig. 1. The form will collect a users’ name, email, whether someone from <em>QuizMe</em> is allowed to contact them at the provided email, the kind of feedback they want to leave, and their message. For now, users will be able to fill out and submit the form, but the app will not yet process the input data submitted. I will cover input processing in the next part of the demo.</p>

<ol>
  <li>
    <p>Create a new POST route for the URL <a href="http://localhost:3000/contact">http://localhost:3000/contact</a> that points to a new <code class="highlighter-rouge">leave_feedback</code> action in the <code class="highlighter-rouge">StaticPagesController</code> class, and name the new route <code class="highlighter-rouge">'leave_feedback'</code>. The new route should look like this:</p>

    <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="n">post</span> <span class="s1">'contact'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'static_pages#leave_feedback'</span><span class="p">,</span> <span class="ss">as: </span><span class="s1">'leave_feedback'</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Create the <code class="highlighter-rouge">leave_feedback</code> action in the <code class="highlighter-rouge">StaticPagesController</code> class. It should return an HTML response that renders the <code class="highlighter-rouge">contact.html.erb</code> view. The action should look like this:</p>

    <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">def</span> <span class="nf">leave_feedback</span>
   <span class="n">respond_to</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
     <span class="nb">format</span><span class="p">.</span><span class="nf">html</span> <span class="p">{</span> <span class="n">render</span> <span class="ss">:contact</span> <span class="p">}</span>
   <span class="k">end</span>
 <span class="k">end</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>In the <code class="highlighter-rouge">contact.html.erb</code> view, replace the form placeholder comment with a form block using the <code class="highlighter-rouge">form_with</code> helper. Specify that the form should send a POST request to the <code class="highlighter-rouge">leave_feedback_path</code> URL by setting the <code class="highlighter-rouge">url</code> and <code class="highlighter-rouge">method</code> arguments of <code class="highlighter-rouge">form_with</code>. By default, <code class="highlighter-rouge">form_with</code> expects the action to return a JavaScript response in the <code class="highlighter-rouge">respond_to</code> block; however, in this case, we need an HTML response. To make the form expect an HTML response, we use the <code class="highlighter-rouge">local: true</code> argument. Thus, the form block should look like this:</p>

    <div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">url: </span><span class="n">leave_feedback_path</span><span class="p">,</span> <span class="ss">local: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">method: :post</span> <span class="k">do</span> <span class="cp">%&gt;</span>

 <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre></div>    </div>

    <p>Notice that <code class="highlighter-rouge">&lt;%= ... %&gt;</code> elements (with an <code class="highlighter-rouge">=</code>) are used for these form helper functions, because the form helpers return raw HTML that we want displayed in the browser.</p>
  </li>
  <li>
    <p>Use the following form helper methods to add the form fields to the <code class="highlighter-rouge">form_with</code> block. API documentation for these helper methods can be found <a href="https://api.rubyonrails.org/v6.0.0/classes/ActionView/Helpers/FormTagHelper.html">here</a>.</p>

    <ol>
      <li>
        <p>Add a text field for the users’ name that looks like this:</p>

        <div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nt">&lt;div&gt;</span>
   <span class="cp">&lt;%=</span> <span class="n">label_tag</span> <span class="s2">"name"</span> <span class="cp">%&gt;</span>
   <span class="cp">&lt;%=</span> <span class="n">text_field_tag</span> <span class="s2">"name"</span><span class="p">,</span> <span class="kp">nil</span> <span class="cp">%&gt;</span>
 <span class="nt">&lt;/div&gt;</span>
</code></pre></div>        </div>

        <p>The <code class="highlighter-rouge">text_field_tag</code> options are the field id (<code class="highlighter-rouge">"name"</code>) and the value in the field (<code class="highlighter-rouge">nil</code> at first). The <code class="highlighter-rouge">label_tag</code> ID should always match its paired form field ID (<code class="highlighter-rouge">"name"</code>).</p>

        <p>Also, in case you are not familiar, a <code class="highlighter-rouge">div</code> HTML element is just a container for other HTML elements, so you can logically group them.</p>
      </li>
      <li>
        <p>Add an email field for the users’ email that looks like this:</p>

        <div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nt">&lt;div&gt;</span>
   <span class="cp">&lt;%=</span> <span class="n">label_tag</span> <span class="s2">"email"</span> <span class="cp">%&gt;</span>
   <span class="cp">&lt;%=</span> <span class="n">email_field_tag</span> <span class="s2">"email"</span><span class="p">,</span> <span class="kp">nil</span> <span class="cp">%&gt;</span>
 <span class="nt">&lt;/div&gt;</span>
</code></pre></div>        </div>

        <p>The <code class="highlighter-rouge">email_field_tag</code> arguments are the field ID (<code class="highlighter-rouge">"email"</code>) and the value in the field (<code class="highlighter-rouge">nil</code> at first).</p>
      </li>
      <li>
        <p>Add a radio button group for whether or not someone from <em>QuizMe</em> is allowed to contact the user at the provided email. The group should have yes/no options and look like this:</p>

        <div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nt">&lt;div&gt;</span>
   <span class="nt">&lt;span&gt;</span>Can we contact you by email?<span class="nt">&lt;/span&gt;</span>
   <span class="nt">&lt;div&gt;</span>
     <span class="cp">&lt;%=</span> <span class="n">radio_button_tag</span> <span class="s2">"reply"</span><span class="p">,</span> <span class="kp">true</span><span class="p">,</span> <span class="kp">true</span> <span class="cp">%&gt;</span>
     <span class="cp">&lt;%=</span> <span class="n">label_tag</span> <span class="s2">"reply_yes"</span><span class="p">,</span> <span class="s1">'Yes'</span> <span class="cp">%&gt;</span>
   <span class="nt">&lt;/div&gt;</span>
   <span class="nt">&lt;div&gt;</span>
     <span class="cp">&lt;%=</span> <span class="n">radio_button_tag</span> <span class="s2">"reply"</span><span class="p">,</span> <span class="kp">false</span><span class="p">,</span> <span class="kp">false</span> <span class="cp">%&gt;</span>
     <span class="cp">&lt;%=</span> <span class="n">label_tag</span> <span class="s2">"reply_no"</span><span class="p">,</span> <span class="s1">'No'</span> <span class="cp">%&gt;</span>
   <span class="nt">&lt;/div&gt;</span>
 <span class="nt">&lt;/div&gt;</span>
</code></pre></div>        </div>

        <p>Similar to a <code class="highlighter-rouge">div</code>, a <code class="highlighter-rouge">span</code> is an HTML container, usually used to wrap some subset of a block of text.</p>

        <p>Radio buttons are used as a group such that the response from the user can be only one of multiple preset options, and only the chosen value will be submitted when the form is submitted. The above radio button has two options, <code class="highlighter-rouge">'Yes'</code> and <code class="highlighter-rouge">'No'</code>, which I will represent with the boolean values <code class="highlighter-rouge">true</code> and <code class="highlighter-rouge">false</code>. Each option needs to have its own <code class="highlighter-rouge">radio_button_tag</code> that controls the value passed back when the form is submitted and a <code class="highlighter-rouge">label_tag</code> that specifies the string the user sees for each option.</p>

        <p>The <code class="highlighter-rouge">radio_button_tag</code> options are:
     - the field ID (<code class="highlighter-rouge">"reply"</code>) which must be the same for all buttons in the group.
     - the value to be returned if this button is checked when the form is submitted (the boolean <code class="highlighter-rouge">true</code> in this case, although radio buttons can be set up to return data of any type).
     - a boolean for whether the button is checked. In this case, we want <code class="highlighter-rouge">'Yes'</code> to be the default option so that button is initially set to be checked and the other is not.</p>

        <p>For a group of radio buttons, the <code class="highlighter-rouge">label_tag</code> options should include a unique ID and the display value. The display value in the <code class="highlighter-rouge">label_tag</code> does not need to be the same as the return value from the <code class="highlighter-rouge">radio_button_tag</code>. By custom, the ID should be the name of the group (<code class="highlighter-rouge">"reply"</code>) followed by an underscore (<code class="highlighter-rouge">_</code>), then a unique string for each option. I chose to use the display values (<code class="highlighter-rouge">yes</code> and <code class="highlighter-rouge">no</code>) as the unique string, but it could just as easily have been something else, like the return values (<code class="highlighter-rouge">true</code> and <code class="highlighter-rouge">false</code>).</p>
      </li>
      <li>
        <p>Add a dropdown list for the kind of feedback the user wants to leave, either a review or a bug report. The dropdown should show the default message “Choose one…” when nothing has been selected. The code for the dropdown should look like this:</p>

        <div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nt">&lt;div&gt;</span>
   <span class="cp">&lt;%=</span> <span class="n">label_tag</span> <span class="s2">"feedback_type"</span> <span class="cp">%&gt;</span>
   <span class="cp">&lt;%=</span> <span class="n">select_tag</span> <span class="s2">"feedback_type"</span><span class="p">,</span> <span class="n">options_for_select</span><span class="p">([</span> <span class="s2">"Review"</span><span class="p">,</span> <span class="s2">"Bug Report"</span> <span class="p">]),</span> <span class="ss">prompt: </span><span class="s1">'Choose one...'</span> <span class="cp">%&gt;</span>
 <span class="nt">&lt;/div&gt;</span>
</code></pre></div>        </div>

        <p>Functionally, dropdown lists are similar to radio buttons in that they allow the user to select one item from a set of predetermined options. However, unlike the Rails helper for radio buttons, the <code class="highlighter-rouge">select_tag</code> helper includes all options for the dropdown by passing them as an array of values (<code class="highlighter-rouge">[ "Review", "Bug Report" ]</code>) into the <code class="highlighter-rouge">options_for_select</code> function. The default text in the dropdown is set using the <code class="highlighter-rouge">prompt</code> option (<code class="highlighter-rouge">'Choose one...'</code>). As with most tag helpers, the first option is the field ID (<code class="highlighter-rouge">"feedback_type"</code>).</p>
      </li>
      <li>
        <p>Add a text area for the user’s message that matches:</p>

        <div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nt">&lt;div&gt;</span>
   <span class="cp">&lt;%=</span> <span class="n">label_tag</span> <span class="s2">"message"</span> <span class="cp">%&gt;</span><span class="nt">&lt;br</span> <span class="nt">/&gt;</span>
   <span class="cp">&lt;%=</span> <span class="n">text_area_tag</span> <span class="s2">"message"</span><span class="p">,</span> <span class="kp">nil</span><span class="p">,</span> <span class="ss">size: </span><span class="s2">"27x7"</span> <span class="cp">%&gt;</span>
 <span class="nt">&lt;/div&gt;</span>
</code></pre></div>        </div>

        <p>An HTML text area is similar to a text field, but it instead allows multi-line user input. The options for the <code class="highlighter-rouge">text_area_tag</code> helper are the field ID (<code class="highlighter-rouge">"message"</code>), the value in the field (<code class="highlighter-rouge">nil</code> at first), and the optional <code class="highlighter-rouge">size</code> option. By default, the text area can hold 2 rows of 21 characters but you can change those values by setting the <code class="highlighter-rouge">rows</code> (R) or <code class="highlighter-rouge">cols</code> (C) options individually or using the size option to specify both in the form <code class="highlighter-rouge">"CxR"</code>.</p>
      </li>
      <li>
        <p>Add a button to submit the feedback form. The button’s code should look like this:</p>

        <div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="cp">&lt;%=</span> <span class="n">submit_tag</span> <span class="s2">"Send Feedback"</span> <span class="cp">%&gt;</span>
</code></pre></div>        </div>

        <p>The <code class="highlighter-rouge">submit_tag</code> actually creates an HTML input tag (<code class="highlighter-rouge">&lt;input type="submit"&gt;&lt;/input&gt;</code>) instead of a button, but visually it still looks like a button when rendered in the browser.</p>

        <p>The main <code class="highlighter-rouge">submit_tag</code> argument is the text that the button will display (<code class="highlighter-rouge">"Send Feedback"</code>).</p>
      </li>
    </ol>
  </li>
</ol>

<h2 id="3-processing-user-submitted-form-data-in-the-controller">3. Processing User-Submitted Form Data in the Controller</h2>

<p>In this part, I will make the <code class="highlighter-rouge">leave_feedback</code> controller action process the user data submitted via a form. All form fields will be required to accept a submission. Submitting the form will reload the <em>Contact</em> page with a status message that tells the user if the submission was valid or if they missed any fields.</p>

<p>Form-input data is sent to the controller via the <code class="highlighter-rouge">params</code> hash. In Ruby, a <em>hash</em> is a key-value data structure (similar to a dictionary in Python). You can set values for all the keys in the hash using code like <code class="highlighter-rouge">options = { font_size: 10, font_family: "Arial" }</code>, or you can set or access a single value using code like <code class="highlighter-rouge">options[:font_size]</code>. When a form is submitted the field ID (key) and value of each form field is added to the <code class="highlighter-rouge">params</code> hash. Also, the params hash only uses string values, so even if the field takes an integer or a boolean it will be converted to a string. You need to be aware of this if you are doing comparisons in the controller.</p>

<p>The controller action should check if all required fields have a value other than <code class="highlighter-rouge">nil</code> or a blank string (i.e., one that is <code class="highlighter-rouge">""</code> or contains only whitespace characters). If all fields have data, the user should be notified that their feedback has been accepted. If not, they should be told to fill out the remaining fields.</p>

<ol>
  <li>
    <p>Check that all fields have been filled by setting a boolean variable <code class="highlighter-rouge">form_complete</code>. This can be achieved by iterating over each form key and checking that it exists in the params hash and that it has a non-blank value. The code to do the checking should look like this:</p>

    <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="n">required</span> <span class="o">=</span> <span class="p">[</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">:reply</span><span class="p">,</span> <span class="ss">:feedback_type</span><span class="p">,</span> <span class="ss">:message</span><span class="p">]</span>
 <span class="n">form_complete</span> <span class="o">=</span> <span class="kp">true</span>
 <span class="n">required</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span>
   <span class="k">if</span> <span class="n">params</span><span class="p">.</span><span class="nf">has_key?</span> <span class="n">f</span> <span class="n">and</span> <span class="n">not</span> <span class="n">params</span><span class="p">[</span><span class="n">f</span><span class="p">].</span><span class="nf">blank?</span>
     <span class="c1"># that's good news. do nothing</span>
   <span class="k">else</span>
     <span class="n">form_complete</span> <span class="o">=</span> <span class="kp">false</span>
   <span class="k">end</span>
 <span class="k">end</span>
</code></pre></div>    </div>

    <p>The <code class="highlighter-rouge">has_key?</code> method checks if the given key exists as a key in the hash. Then, you can check that the string value for that key is not nil or blank with the <code class="highlighter-rouge">blank?</code> method.</p>
  </li>
  <li>
    <p>After the app determines whether the form is complete and accepted, it passes an appropriate status message to the view. To set this up, do the following.</p>

    <ol>
      <li>
        <p>Set the status message in the controller based on the <code class="highlighter-rouge">form_complete</code> boolean. The code should match:</p>

        <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">if</span> <span class="n">form_complete</span>
   <span class="n">form_status_msg</span> <span class="o">=</span> <span class="s1">'Thank you for your feedback!'</span>
 <span class="k">else</span>
   <span class="n">form_status_msg</span> <span class="o">=</span> <span class="s1">'Please fill in all the remaining form fields and resubmit.'</span>
 <span class="k">end</span>
</code></pre></div>        </div>
      </li>
      <li>
        <p>Pass the status message into the response by adding a new local variable to match:</p>

        <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nb">format</span><span class="p">.</span><span class="nf">html</span> <span class="p">{</span> <span class="n">render</span> <span class="ss">:contact</span><span class="p">,</span> <span class="ss">locals: </span><span class="p">{</span> <span class="ss">status_msg: </span><span class="n">form_status_msg</span> <span class="p">}</span> <span class="p">}</span>
</code></pre></div>        </div>
      </li>
      <li>
        <p>Add code to <code class="highlighter-rouge">contact.html.erb</code> below the <em>Feedback</em> heading to display the status message if it has been set. The code should look like this:</p>

        <div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="cp">&lt;%</span> <span class="k">if</span> <span class="n">local_assigns</span><span class="p">.</span><span class="nf">has_key?</span> <span class="ss">:status_msg</span> <span class="cp">%&gt;</span>
   <span class="nt">&lt;p&gt;</span><span class="cp">&lt;%=</span> <span class="n">status_msg</span> <span class="cp">%&gt;</span><span class="nt">&lt;/p&gt;</span>
 <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre></div>        </div>

        <p>Similar to the <code class="highlighter-rouge">params</code> hash, local variables available in the view are also stored in a hash called <code class="highlighter-rouge">local_assigns</code>. You can use the <code class="highlighter-rouge">has_key?</code> method to check that the status message has been set.</p>
      </li>
    </ol>
  </li>
  <li>
    <p>At this point, the user should be able to submit the form and see the response message. However, if the user is told the form was incomplete, the current version of the app requires them to re-enter their information for all the fields, not just the ones that were missing/invalid. We can fix this usability problem by passing the data from the <code class="highlighter-rouge">params</code> hash back into the view in a new hash local variable <code class="highlighter-rouge">feedback</code>. Then, in the view, we can set the value of each form field based on the <code class="highlighter-rouge">feedback</code> hash. If a field has no value in the <code class="highlighter-rouge">feedback</code> hash, it will be set to the original default value for the field. The following steps set this up:</p>

    <ol>
      <li>
        <p>Add the <code class="highlighter-rouge">feedback</code> variable to the response by changing the HTML response to match:</p>

        <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nb">format</span><span class="p">.</span><span class="nf">html</span> <span class="p">{</span> <span class="n">render</span> <span class="ss">:contact</span><span class="p">,</span> <span class="ss">locals: </span><span class="p">{</span> <span class="ss">status_msg: </span><span class="n">form_status_msg</span><span class="p">,</span> <span class="ss">feedback: </span><span class="n">params</span> <span class="p">}</span> <span class="p">}</span>
</code></pre></div>        </div>
      </li>
      <li>
        <p>Change the fields’ values to come from the <code class="highlighter-rouge">feedback</code> hash if set and to use the default if not. Previously, we used the <code class="highlighter-rouge">has_key?</code> method with an <code class="highlighter-rouge">if</code> statement to optionally set this. We might try doing the same here using the following <a href="https://syntaxdb.com/ref/ruby/ternary">ternary operator</a>:</p>

        <div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="cp">&lt;%=</span> <span class="n">text_field_tag</span> <span class="s2">"name"</span><span class="p">,</span> <span class="n">feedback</span><span class="p">.</span><span class="nf">has_key?</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span> <span class="p">?</span> <span class="n">feedback</span><span class="p">[:</span><span class="nb">name</span><span class="p">]</span> <span class="p">:</span> <span class="kp">nil</span> <span class="cp">%&gt;</span>
</code></pre></div>        </div>

        <p>However, this change would need to be made for every field, and it could quickly become overly complicated. Instead, we will use the hash <code class="highlighter-rouge">fetch</code> operation to get the value for a key if the key exists, or to specify what value to return if the key is not found. Using <code class="highlighter-rouge">fetch</code>, the code for all the fields should be updated to look like the following.</p>

        <p>The text fields and text area are fairly straightforward:</p>

        <div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="cp">&lt;%=</span> <span class="n">text_field_tag</span> <span class="s2">"name"</span><span class="p">,</span> <span class="n">feedback</span><span class="p">.</span><span class="nf">fetch</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="kp">nil</span><span class="p">)</span> <span class="cp">%&gt;</span>
</code></pre></div>        </div>

        <div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="cp">&lt;%=</span> <span class="n">email_field_tag</span> <span class="s2">"email"</span><span class="p">,</span> <span class="n">feedback</span><span class="p">.</span><span class="nf">fetch</span><span class="p">(</span><span class="ss">:email</span><span class="p">,</span> <span class="kp">nil</span><span class="p">)</span> <span class="cp">%&gt;</span>
</code></pre></div>        </div>

        <div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="cp">&lt;%=</span> <span class="n">text_area_tag</span> <span class="s2">"message"</span><span class="p">,</span> <span class="n">feedback</span><span class="p">.</span><span class="nf">fetch</span><span class="p">(</span><span class="ss">:message</span><span class="p">,</span> <span class="kp">nil</span><span class="p">),</span> <span class="ss">size: </span><span class="s2">"27x7"</span> <span class="cp">%&gt;</span>
</code></pre></div>        </div>

        <p>With radio buttons, you need to make sure that the checked value is set based on the value for the <code class="highlighter-rouge">"reply"</code> key. You also need to convert the true/false values to strings using the <code class="highlighter-rouge">to_s</code> method before making the comparison, like this:</p>

        <div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nt">&lt;div&gt;</span>
   <span class="cp">&lt;%=</span> <span class="n">radio_button_tag</span> <span class="s2">"reply"</span><span class="p">,</span> <span class="kp">true</span><span class="p">,</span> <span class="n">feedback</span><span class="p">.</span><span class="nf">fetch</span><span class="p">(</span><span class="ss">:reply</span><span class="p">,</span> <span class="kp">nil</span><span class="p">)</span> <span class="o">==</span> <span class="kp">true</span><span class="p">.</span><span class="nf">to_s</span> <span class="cp">%&gt;</span>
   <span class="cp">&lt;%=</span> <span class="n">label_tag</span> <span class="s2">"reply_yes"</span><span class="p">,</span> <span class="s1">'Yes'</span> <span class="cp">%&gt;</span>
 <span class="nt">&lt;/div&gt;</span>
 <span class="nt">&lt;div&gt;</span>
   <span class="cp">&lt;%=</span> <span class="n">radio_button_tag</span> <span class="s2">"reply"</span><span class="p">,</span> <span class="kp">false</span><span class="p">,</span> <span class="n">feedback</span><span class="p">.</span><span class="nf">fetch</span><span class="p">(</span><span class="ss">:reply</span><span class="p">,</span> <span class="kp">nil</span><span class="p">)</span> <span class="o">==</span> <span class="kp">false</span><span class="p">.</span><span class="nf">to_s</span> <span class="cp">%&gt;</span>
   <span class="cp">&lt;%=</span> <span class="n">label_tag</span> <span class="s2">"reply_no"</span><span class="p">,</span> <span class="s1">'No'</span> <span class="cp">%&gt;</span>
 <span class="nt">&lt;/div&gt;</span>
</code></pre></div>        </div>

        <p>With dropdown selects, the selected option is the second parameter to the <code class="highlighter-rouge">options_for_select</code> method. If nothing is selected, it should be set to the empty string <code class="highlighter-rouge">""</code> (and not <code class="highlighter-rouge">nil</code>), like this:</p>

        <div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="cp">&lt;%=</span> <span class="n">select_tag</span> <span class="s2">"feedback_type"</span><span class="p">,</span> <span class="n">options_for_select</span><span class="p">([</span> <span class="s2">"Review"</span><span class="p">,</span> <span class="s2">"Bug Report"</span> <span class="p">],</span> <span class="n">feedback</span><span class="p">.</span><span class="nf">fetch</span><span class="p">(</span><span class="ss">:feedback_type</span><span class="p">,</span> <span class="s2">""</span><span class="p">)),</span> <span class="ss">prompt: </span><span class="s1">'Choose one...'</span> <span class="cp">%&gt;</span>
</code></pre></div>        </div>
      </li>
    </ol>
  </li>
</ol>

<p>We should now have a working form that users can use to easily enter their feedback and see if it has been accepted. We will see in the next few demos how to further improve this form by using remote form submission (to stop the page from reloading every time the form is submitted) and using so-called <em>flash</em> messages (to display a more dynamic status message). Of course, at this point, a big omission to the feedback form feature is having it actually do something useful with the submitted data, like saving the data. Upcoming demos will also cover a variety of ways to save and process such form data.</p>

            </div> <!-- /.container -->

        </main>

        <footer class="container">
            <hr style="margin-top: 2rem;">
            <p style="text-align: center;">
                &copy; <a href="/about/">The Authors</a> 2019
            </p>
        </footer>

        <!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

    </body>
</html>
